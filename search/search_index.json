{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stemmer","trimmer","stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":"<p>Already in a crisis ? Don't waste time, cheat</p> <p>Looking for Forensic ressources ? Check DFRecipes website.</p>"},{"location":"reflex-content/","title":"\u26d1\ufe0f Reflex-content","text":"<p>This repository contains all content for the reflex website.</p> <p>The website engine is available in the reflex repository.</p>"},{"location":"reflex-content/#content","title":"\ud83d\udcc4 Content","text":"<p>This website use mkdocs and mkdocs-material and bunch of plugins to generate the documentation.</p> <p>You can submit PR to add content with markdown files.</p> <p>All of this repository content is under CC BY-NC-SA 4.0 licence.</p> <p>Attribution-NonCommercial-ShareAlike 4.0 International</p>"},{"location":"reflex-content/LICENCE/","title":"Licence","text":"<p>The content of this deposit is subject to the CC BY-NC-SA 4.0</p>"},{"location":"reflex-content/Attack/dorks/","title":"Dorks","text":"<p>Dorks documentation available.</p>"},{"location":"reflex-content/Attack/dorks/#best-dorks","title":"Best dorks","text":"<p>Global</p> Dorks\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 Description\u00a0   \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <code>site:&lt;domain&gt; filetype:pdf OR filetype:doc OR filetype:xls</code> Find interesting office documents <code>site:bgp.he.net \"&lt;domain&gt;\"</code> Find AS and discover IP bands\u00a0 <p>Professionnal search</p> Dorks\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0            \u00a0 Description\u00a0   \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0       \u00a0 <code>site:linkedin.com \"&lt;name or company&gt;\"</code> Find worker profile or company employes on Linkedin <code>site:viadeo.com \"&lt;name or company&gt;\"</code> Find worker profile or company employes on Viadeo <code>site:malt.fr \"&lt;name or company&gt;\"</code> Find worker profile or company employes on Malt <p>Job Offer</p> Dorks\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0              \u00a0 Description\u00a0   \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <code>site:cadres.apec.fr\"&lt;company&gt;\"</code> Find job offer on Cadre Apec <code>site:welcometothejungle.com \"&lt;company&gt;\"</code> Find job offer on WelcomeToTheJungle"},{"location":"reflex-content/Attack/ftp/","title":"FTP","text":"<p>Port : <code>21</code></p>"},{"location":"reflex-content/Attack/osint/","title":"Osint","text":"Error <p>In progress</p>"},{"location":"reflex-content/Attack/osint/#ressources","title":"Ressources","text":"<ul> <li>Osint Map</li> </ul>"},{"location":"reflex-content/Attack/ports_scan/","title":"Ports scan","text":"Nmap quick win Commands Description <code>nmap 192.168.1.1/24 -sn</code> Host discovery <code>sudo nmap -sSVC -O -T4 192.168.1.1</code> TCP Scan ++ <code>sudo nmap -sSVC -O -f -T1 192.168.1.1</code> TCP Scan stealth Nmap flags Flags Description <code>-sS</code> TCP SYN <code>-sT</code> TCP Connect <code>-sA</code> TCP ACK <code>-sN,-sF,-sX</code> TCP NULL, FIN, XMAS <code>-sU</code> UDP (Slow) <code>-sV</code> Detect versions <code>-O</code> OS Fingerprinting <code>-f</code> Fragment packets <code>-p 0-1024</code> Ports range <code>-T0</code> Aggressivity (0 to 5) <code>-Pn</code> Skip host discovery <code>-iL</code> Using input target from files"},{"location":"reflex-content/Attack/redis/","title":"Redis","text":"<p>Port : <code>6379</code></p>"},{"location":"reflex-content/Attack/redis/#redis-cli","title":"Redis-Cli","text":"<p>Ping database</p> Bash<pre><code>redis-cli -h $TARGET -p 6379 PING\n</code></pre> <p>Connect to database</p> Bash<pre><code>redis-cli -h $TARGET -p 6379\n# With password\nredis-cli -h $TARGET -p 6379 -a\n</code></pre> <p>List all keys</p> Bash<pre><code>redis-cli -h $TARGET -p 6379 --scan\n</code></pre> <p>For security reasons, provide the password to redis-cli automatically via the REDISCLI_AUTH environment variable.</p> CLI commands Commands Description <code>get key_name</code> Retrieve key value <code>keys *</code> List all keys <code>info</code> Retrieve informations about redis instance"},{"location":"reflex-content/Attack/smb/","title":"SMB","text":"<p>Port : <code>445</code></p>"},{"location":"reflex-content/Attack/smb/#smb-client","title":"SMB-Client","text":"<p>List shares</p> Bash<pre><code>smbclient --no-pass //$TARGET -L\n</code></pre> <p>List files</p> Bash<pre><code>smbclient --no-pass //$TARGET/$SHARE -c \"ls\"\n# List folder\nsmbclient --no-pass //$TARGET/$SHARE -c \"ls dir/\"\n</code></pre> <p>Download file</p> Bash<pre><code>smbclient --no-pass //$TARGET/$SHARE -c \"get file.txt local_file.txt\"\n</code></pre> <p>Connect to a server with username</p> Bash<pre><code>smbclient //$TARGET/$SHARE -U &lt;username&gt;\n</code></pre> <p>Interactive mode</p> Bash<pre><code>smbclient --no-pass //$TARGET/$SHARE -I\"\n</code></pre>"},{"location":"reflex-content/Attack/smb/#sources","title":"Sources","text":"<ul> <li>Hacking Windows shares from Linux with Samba</li> </ul>"},{"location":"reflex-content/Attack/web/","title":"Web","text":"DNS Enumeration Commands Description <code>gobuster dns -d $TARGET -w ~/wordlists/subdomains.txt --wildcard</code> Subdomains discovery <code>subfinder -d $TARGET</code> Passive subdomain enumeration vhost Enumeration Commands Description <code>gobuster vhost -u https://$TARGET -w  ~/wordlists/vhosts-wordlist.txt</code> Vhost discovery <p>Small and compact webserver with python standard library</p> <p><code>python3 -m http.server 80</code></p>"},{"location":"reflex-content/Defend/investigation/","title":"Investigation","text":""},{"location":"reflex-content/Defend/investigation/#disks","title":"Disks","text":"<p>Convert disk to RAW image</p> Bash<pre><code># From VMWare\nqemu-img convert -f vmdk -O raw disk.vmdk disk.img\n# From Virtualbox\nqemu-img convert -f ova -O raw disk.vmdk disk.img\n</code></pre> <p>Unpack LVM</p> Bash<pre><code>kpartx -a -v $DUMP.lvm2\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#docker-containers","title":"Docker containers","text":"Bash<pre><code>docker exec -it $CONTAINERNAME /bin/bash\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#tracks","title":"Tracks","text":""},{"location":"reflex-content/Defend/investigation/#other","title":"Other","text":"<p>Get hostname</p> Bash<pre><code>/etc/hostname\n</code></pre> <p>Get timezone</p> Bash<pre><code>/etc/timezone\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#network","title":"Network","text":"<p>List interfaces</p> Bash<pre><code>cat /etc/network/interfaces\n</code></pre> <p>List actives connections</p> Bash<pre><code>netstat -natp\n</code></pre> <p>List hardcoded dns</p> Bash<pre><code>cat /etc/hosts\n</code></pre> <p>Get DNS settings</p> Bash<pre><code>cat /etc/resolv.conf\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#usergroupsrights","title":"User/Groups/Rights","text":"<p>List users from <code>passwd</code></p> Bash<pre><code>cat /etc/passwd | column -t -s :\n</code></pre> <p>List sudoers</p> Bash<pre><code>sudo cat /etc/sudoers\n</code></pre> <p>List groups</p> Bash<pre><code>cat /etc/group\n# Find users from a group\ncat /etc/group | grep '$GROUPNAME'\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#persistant","title":"Persistant","text":""},{"location":"reflex-content/Defend/investigation/#startup","title":"Startup","text":"Bash<pre><code>ls /etc/init.d\nls /etc/profile.d\ncat ~/.bashrc\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#cron","title":"Cron","text":"<p>List cron tasks</p> Bash<pre><code>crontab -l\n# Root\nless /etc/crontab\n# From a user\nsudo crontab -u $USERNAME -l\n# Hourly\nls -la /etc/cron.hourly/\n# Daily\nls -la /etc/cron.daily/\n# Weekly\nls -la /etc/cron.weekly/\n# Montly\nls -la /etc/cron.montly/\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#logs","title":"Logs","text":"Manipulate logs Bash<pre><code>less -r $LOGFILE\ntail -n $LINES $LOGFILE\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#auth","title":"Auth","text":"<p>Last login</p> Bash<pre><code>sudo last -f /var/log/wtmp\n</code></pre> <p>Auth</p> Bash<pre><code>cat /var/log/auth.log | less -r\n</code></pre> <p>Bash history</p> Bash<pre><code>cat /home/$USER/.bash_history | less -r\n</code></pre> <p>SSH Key</p> Bash<pre><code>cat /home/$USER/.ssh/authorized_keys | less -r\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#proccessus","title":"Proccessus","text":"Bash<pre><code># Netcat detection\nps -aux | grep 'nc '\n</code></pre>"},{"location":"reflex-content/Defend/investigation/#sources","title":"Sources","text":"<ul> <li>Phoenixnap home contact support blog Glossary How to List, Display, &amp; View all Current Cron Jobs in Linux</li> </ul>"},{"location":"reflex-content/Defend/OS/bsd/","title":"BSD","text":"<p>Berkley Software Distribution (BSD) is a UNIX-like system used as base OS for firewall distributions like pfsense or OPNsens.</p>"},{"location":"reflex-content/Defend/OS/bsd/#user-management","title":"User management","text":"Commands SearchLock usersManage users Command Description <code>w</code> Shows all logged users and what they are doing <code>logins -a</code> List user with details <code>logins -l [user]</code> Get user details Command Description <code>pw lock [user]</code> Lock user <code>chsh -s /usr/sbin/nologin [user]</code> Lock user shell <code>pw unlock [user]</code> Unlock user Command Description <code>pw useradd -n [user] -s /bin/csh</code> Adding user <code>pw useradd -n [user] -s /bin/csh -m</code> Adding user with home directory <code>passwd [user]</code> Change user password <code>pw userdel [user]</code> Delete user <code>pw userdel [user] -r</code> Delete user and home directory"},{"location":"reflex-content/Defend/OS/bsd/#other","title":"Other","text":"Time management Command Description <code>tzsetup</code> Setup timezone"},{"location":"reflex-content/Defend/OS/bsd/#importants-files","title":"Importants files","text":"Files Description <code>/etc/master.passwd</code> Textual database for admins users <code>/etc/passwd</code> Textual database for normal users"},{"location":"reflex-content/Defend/OS/linux/","title":"Linux","text":""},{"location":"reflex-content/Defend/OS/linux/#user-management","title":"User management","text":"Commands SearchLock usersManage users Command Description <code>w</code> Shows all logged users and what they are doing <code>getent passwd</code> List users with details <code>logins -l [user]</code> Get user details Command Description <code>passwd --status [user]</code> Check user lock status <code>chage -l root [user]</code> Check user expire status <code>chage -E0  [user]</code> Lock user by expiring account <code>usermod -s /sbin/nologin [user]</code> Lock user shell Command Description <code>id [user</code> Check user id <code>useradd [user]</code> Adding user <code>useradd -m [user]</code> Adding user with home directory <code>passwd [user]</code> Change user password <code>userdel [user]</code> Delete user <code>userdel -r [user]</code> Delete user and home directory"},{"location":"reflex-content/Defend/OS/linux/#other","title":"Other","text":"Time management Command Description <code>timedatectl</code> Get time configuration <code>timedatectl list-timezones</code> List all timezone (Europe/Paris for ) <code>timedatectl set-timezone [timezone]</code> Set timezone"},{"location":"reflex-content/Defend/OS/linux/#importants-files","title":"Importants files","text":"Files Description <code>/etc/shadow</code> Textual database for admins users <code>/etc/passwd</code> Textual database for normal users"},{"location":"reflex-content/Defend/OS/windows/","title":"Windows","text":""},{"location":"reflex-content/Defend/OS/windows/#user-management","title":"User management","text":"Manage WSUS state Command Description <code>Set-Service -Name wsusservice -Status Running -PassThru</code> Enable WSUS <code>Start-Service wsusservice  -PassThru</code> Start WSUS"},{"location":"reflex-content/Defend/OS/windows/#windows-update","title":"Windows Update","text":"<p>Manage Windows Server Update Service (WSUS).</p> Manage WSUS state Command Description <code>Set-Service -Name wsusservice -Status Running -PassThru</code> Enable WSUS <code>Start-Service wsusservice  -PassThru</code> Start WSUS Time management Command Description <code>Get-TimeZone</code> Get time configuration <code>Get-TimeZone -ListAvailable</code> List all timezone (Romance Standard Time\" for ) <code>Set-TimeZone -Id \"Romance Standard Time\"</code> Set timezone for Europe"},{"location":"reflex-content/Defend/OS/windows/#ad","title":"AD","text":"<p>https://www.it-connect.fr/modules/installation-et-configuration-de-wsus/</p>"},{"location":"reflex-content/Defend/OS/windows/#ajouter-utilisateur","title":"Ajouter utilisateur","text":"<ul> <li>Console <code>mmc</code></li> <li>Utilisateurs et ordinateurs AD ~&gt; xxx.xyz ~&gt; Users ~&gt; Logo utilisateur bleu</li> <li>Suivre l'assistant</li> </ul> <p>Sinon outil d\u00e9di\u00e9 ~&gt; <code>dsa.msc</code></p>"},{"location":"reflex-content/Defend/OS/windows/#creer-gpo","title":"Cr\u00e9er GPO","text":"<ul> <li>Console <code>mmc</code></li> <li>Gestion des strat\u00e9gies de groupe ~&gt; For\u00eat ~&gt; Domaines ~&gt; corpxx.local ~&gt; Objets de strat\u00e9gie de groupe</li> <li>Click droit, cr\u00e9er GPO</li> <li>Click droit sur la GPO ~&gt; Editer</li> </ul>"},{"location":"reflex-content/Defend/OS/windows/#appliquer-gpo","title":"Appliquer GPO","text":"<p>Rappel de la hi\u00e9rarchie d'application des GPO</p> <p></p> <ul> <li>Console <code>mmc</code></li> <li>Gestion des strat\u00e9gies de groupe ~&gt; For\u00eat ~&gt; Domaines ~&gt; corpxx.local ~&gt; Objets de strat\u00e9gie de groupe</li> </ul>"},{"location":"reflex-content/Defend/OS/windows/#hardening","title":"Hardening","text":"<ul> <li>T\u00e9l\u00e9charger et lancer ping castle</li> <li> <p>Lire le rapport</p> </li> <li> <p>D\u00e9sactiver SMBv1 via la console des fonctionnalit\u00e9s</p> </li> <li>Installer LAPS depuis le site officiel</li> <li>D\u00e9sactiver le service Spoiler d'impression dans la console des services</li> <li>D\u00e9sactiver netbios depuis la fonction avanc\u00e9 de l'adapateur ethernet</li> </ul>"},{"location":"reflex-content/Defend/OS/windows/#sources","title":"Sources","text":"<ul> <li>Powershell Documentation - Set-Service</li> </ul>"},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/","title":"step by step AD","text":""},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#active-directory","title":"Active Directory","text":""},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#configuration-du-controleur-de-domaine","title":"Configuration du contr\u00f4leur de domaine","text":"<ul> <li>[x] Se connecter au DC en tant qu'Administrateur et acc\u00e9der au tableau de bord</li> <li>[x] Changer le nom du Serveur pour y mettre un nom explicite (SRV-DC01)</li> <li>[x] Ajouter des r\u00f4les et fonctionnalit\u00e9s depuis \"G\u00e9rer\" en haut \u00e0 droite</li> <li>[x] Dans \"R\u00f4les de serveurs\", cocher \"Service AD DS\" et \"Service DNS\"</li> <li> <p>[x] Laisser le reste par d\u00e9faut, puis \"Installer\"</p> </li> <li> <p>[x] Promouvoir ce serveur en contr\u00f4leur de domaine</p> </li> </ul> <p></p> <ul> <li> <p>[x] Configurer le d\u00e9ploiement de l'AD</p> <ul> <li>[x] Ajouter un nouvelle for\u00eat : corp05.com</li> <li>[x] Ajouter un mot de passe de restauration des services d'annuaires</li> </ul> </li> </ul> <p></p> <ul> <li>[x] V\u00e9rifier la configuration puis \"Installer\" (le serveur va red\u00e9marrer)</li> </ul> <p>Pour g\u00e9rer les services Active Directory, vous trouvez l'outil \"Utilisateurs et ordinateurs Active Directory\" dans le menu d\u00e9marrer, et dans \u00ab Outils d\u2019administration \u00bb</p> <ul> <li>[x] Cr\u00e9ation d\u2019un nouvel objet \u201cutilisateur\u201d dans l'AD</li> </ul> <p></p>"},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#ajout-dun-second-controleur-de-domaine","title":"Ajout d'un second contr\u00f4leur de domaine","text":"<ul> <li>[x] Ajouter le serveur au domaine</li> <li>[x] Ajouter le r\u00f4le AD DS</li> <li>[x] Promouvoir le serveur en tant que cont\u00f4leur de domaine</li> <li>[x] Cocher \"Ajouter un contr\u00f4leur de domaine \u00e0 un domaine existant\"</li> </ul> <ul> <li>[x] S\u00e9lectionner le serveur \u00e0 partir duquel vous voulez r\u00e9pliquer les donn\u00e9es AD</li> </ul> <ul> <li>[x] V\u00e9rifier la bonne remont\u00e9e du DC02 depuis la console du DC01</li> </ul>"},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#jonction-dune-machine-windows-au-domaine","title":"Jonction d'une machine Windows au domaine","text":"<p>Sur le poste client, commencez par lui attribuer une adresse IP fixe et     une adresse de DNS principal (pr\u00e9f\u00e9r\u00e9) du serveur AD.</p> <p>Dans les param\u00e8tres avanc\u00e9s, allez dans l\u2019onglet DNS. Dans la partie \u00ab Suffixe DNS pour cette connexion \u00bb, renseignez le nom     complet de votre domaine. Cochez la case \u00ab Utiliser le suffixe DNS de cette connexion pour           l\u2019enregistrement DNS \u00bb.</p> <ul> <li>[x] Test de ping sur le nom du serveur (ping SRV-DC01)</li> </ul> <p>Depuis les param\u00e8tres de la machine (Panneau de config&gt; Syst\u00e8me et         S\u00e9curit\u00e9 &gt; Syst\u00e8me &gt; Renommer ce PC), renommez le poste client par un       nom identifiable ou une appelation d\u00e9finie par la politique de             nommage de l\u2019entreprise (PC-001, PC-COMPTA-1\u2026). Dans la partie \u00ab Membre d\u2019un \u00bb, cochez Domaine et renseignez le nom de     votre domaine.</p> <p></p> <ul> <li>[x] Renommer le client et le joindre au domaine (identifiants admin n\u00e9cessaires)</li> </ul> <p></p> <ul> <li>[x] Red\u00e9marrer et se connection avec un compte user du domaine</li> </ul>"},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#gpo","title":"GPO","text":""},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#strategie-daudit","title":"Strat\u00e9gie d'audit","text":"<p>On modifie la default domain policy puis on suit le guide d'hygi\u00e8ne de l'ANSSI.</p> <p>On active toutes les strat\u00e9gies d'audit de base \u00e0 cet endroit : </p> <p><code>Configuration ordinateur\\Strat\u00e9gies\\Param\u00e8tres Windows\\Param\u00e8tres de s\u00e9curit\u00e9\\Strat\u00e9gies locales\\ Strat\u00e9gie d'audit</code></p> <p></p> <p>Et on fait la m\u00eame chose, plus finement, avec les strat\u00e9gies d'audit avanc\u00e9es : </p> <p><code>Configuration ordinateur\\Strat\u00e9gies\\Param\u00e8tres Windows\\Param\u00e8tres de s\u00e9curit\u00e9\\Configuration avanc\u00e9e de la strat\u00e9gie d'audit\\Strat\u00e9gies d'audit syst\u00e8me - Objet Strat\u00e9gie de groupe</code></p>"},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#monter-un-disque-reseau","title":"Monter un disque r\u00e9seau","text":"<ul> <li> <p>[x] Ouvrir la console \"Gestion de strat\u00e9gie de groupe\" depuis le DC ou depuis un poste utilisateur avec RSAT</p> </li> <li> <p>[x] Clic droit sur \"Objets de strat\u00e9gie de groupe\" puis \"Nouveau\". Nommer cette GPO, par exemple \"U_Lecteur-\". <li> <p>[x] Modifier cette GPO et acc\u00e9der \u00e0 l'emplacement suivant : <code>Configuration utilisateur &gt; Pr\u00e9f\u00e9rences &gt; Param\u00e8tres Windows &gt; Mappages de lecteur</code></p> </li> <p>Puis <code>Sur la droite, effectuer un clic droit : Nouveau &gt; Lecteur mapp\u00e9</code></p> <ul> <li>[x] Saisir les informations du lecteur r\u00e9seau <p>L'emplacement du lecteur r\u00e9seau peut se trouver sur un serveur de fichier</p> </li> </ul> <p></p> <ul> <li>[x] Lier la GPO \u00e0 un OU / Groupe de s\u00e9curit\u00e9 / User</li> </ul> <p>Afin de d\u00e9ployer la GPO \u00e0 un ou des utilisateur(s) sp\u00e9cifique(s) : 1. S\u00e9lectionner la GPO dans \"Objets de strat\u00e9gie de groupe\" 2. Ajouter un utilisateur, Groupe de s\u00e9curit\u00e9, ordinateur dans le menu \"Etendue\" &gt; Filtrage de s\u00e9curit\u00e9 3. Supprimer \"Utilisateurs authentifi\u00e9s\"</p> <p></p> <ol> <li> <p>Ajouter \"Utilisateurs authentifi\u00e9s dans \"D\u00e9l\u00e9gation\" avec des autorisations de Lecture.</p> </li> <li> <p>[x] Tester la GPO un ordinateur du domaine avec un utilisateur authentifi\u00e9</p> <p>Commande powershell pour forcer le d\u00e9ploiement : gpupdate /force Commande powershell pour voir le contenue du d\u00e9ploiement : gpresult /r</p> </li> </ol>"},{"location":"reflex-content/Defend/application/AD/step-by-step-AD/#installation-dun-logiciel","title":"Installation d'un logiciel","text":"<ul> <li> <p>[x] Ouvrir la console \"Gestion de strat\u00e9gie de groupe\" depuis le DC ou depuis un poste utilisateur avec RSAT</p> </li> <li> <p>[x] Clic droit sur \"Objets de strat\u00e9gie de groupe\" puis \"Nouveau\". Nommez cette GPO, par exemple \"O_Deployer-\". <li> <p>[x] Modifier cette GPO et acc\u00e9der \u00e0 l'emplacement suivant : <code>Configuration ordinateur &gt; Strat\u00e9gies &gt; Param\u00e8tres du logiciel &gt; Installation de logiciel</code></p> </li> <li> <p>[x] Effectuer un clic droit sur \"Installation de logiciel\" puis sous \"Nouveau\" cliqurz sur \"Package\"</p> </li> <li> <p>[x] Indiquer le chemin vers le fichier MSI. </p> <p>Utiliser un chemin r\u00e9seau vers un partage r\u00e9seau (serveur de fichier) pour rechercher le fichier MSI.</p> </li> <p>Lorsque l'on d\u00e9ploie un logiciel, il y a deux modes principaux :</p> <p>Publi\u00e9 : ce mode est disponible dans le cas de l'installation d'un logiciel dans les param\u00e8tres utilisateurs. Le logiciel est alors disponible \u00e0 l'installation sur la machine, mais il ne s'installe pas automatiquement. L'utilisateur peut installer le logiciel s'il en a besoin. Attribu\u00e9 : ce mode sert \u00e0 installer un logiciel par GPO sur une machine, de mani\u00e8re automatique. C'est ce qui nous int\u00e9resse aujourd'hui.</p> <ul> <li> <p>[x] S\u00e9lectionner le mode \"Attribu\u00e9\"</p> </li> <li> <p>[x] Lier la GPO \u00e0 un OU / Groupe de s\u00e9curit\u00e9 / User / Ordinateur</p> </li> </ul> <p>Afin de d\u00e9ployer la GPO \u00e0 un ou des utilisateur(s) sp\u00e9cifique(s) : 1. S\u00e9lectionner la GPO dans \"Objets de strat\u00e9gie de groupe\" 2. Ajouter un ordinateur dans le menu \"Etendue\" &gt; Filtrage de s\u00e9curit\u00e9 3. Supprimer \"Utilisateurs authentifi\u00e9s\"</p> <p></p> <ol> <li> <p>Ajouter \"Utilisateurs authentifi\u00e9s dans \"D\u00e9l\u00e9gation\" avec des autorisations de Lecture.</p> </li> <li> <p>[x] Tester la GPO sur un ordinateur du domaine avec un utilisateur authentifi\u00e9</p> <p>Commande powershell pour forcer le d\u00e9ploiement : gpupdate /force Commande powershell pour voir contenue du d\u00e9ploiement : gpresult /r</p> </li> </ol>"},{"location":"reflex-content/Defend/application/exchange/step-by-step-exchange/","title":"Step by step exchange","text":""},{"location":"reflex-content/Defend/application/exchange/step-by-step-exchange/#exchange","title":"Exchange","text":""},{"location":"reflex-content/Defend/application/exchange/step-by-step-exchange/#configuration-serveur-exchange","title":"Configuration Serveur Exchange","text":"<p>Nous configurons le serveur Windows Exchange en tant que serveur mail. Pour cela nous suivons la documentation Microsoft.</p> <p></p> <p>Afin d'\u00e9viter les erreurs, il faut avoir quelques pr\u00e9requis :  - [x] Renommer le serveur avec un nom explicite - [x] Joindre le domaine AD - [x] Installer .NET Framework 4.8 - [x] Installer Visual Studio 2013 - [x] Installer la fonctionnalit\u00e9 [Server Media Foundation] : <code>Install-WindowsFeature Server-Media-Foundation</code> - [x] Installer les outils Remote Server Administration via PS Admin : <code>Install-WindowsFeature NET-Framework-45-Features, RSAT-ADDS</code> - [x] Pr\u00e9parer le \"Sch\u00e9ma\" pour le setup : <code>Setup.exe /PrepareSchema /IAcceptExchangeServerLicenseTerms</code> - [x] Pr\u00e9parer l'AD pour le setup : <code>Setup.exe /PrepareAD /OrganizationName:\u201dcorp05\u201d /IAcceptExchangeServerLicenseTerms</code> - [x] Lancer le <code>Setup.exe</code> et laisser les param\u00e8tres par d\u00e9faut</p> <p>Une fois cela fait :  - [x] Se connecter au Centre d'Administration Exchange (depuis le menu d\u00e9marrer) - [x] Configurer Outlook de sortes \u00e0 ce que nos utilisateurs AD b\u00e9n\u00e9ficie d'une boite mail : Destinataire &gt; BAL &gt; Nouveau (+) &gt; S\u00e9lectionner les utilisateurs de l'AD et leur attribuer un alias.</p> <p>En tant qu'utilisateur, nous pouvons nous connecter \u00e0 l'interface web, avec notre identifiant mail et le mot de passe de notre session AD.</p> <p>il faut penser \u00e0 ouvrir les flux Web entre les USER et l'EXCHANGE</p>"},{"location":"reflex-content/Defend/application/malwares/analysis/","title":"Analysis","text":"<p>Capacities Mitre Att@ck</p>"},{"location":"reflex-content/Defend/application/malwares/analysis/#static","title":"Static","text":"Yara quick scan <p><code>yara index.yar &lt;suspicious.exe&gt; 2&gt;/dev/null</code></p> Tools Usage Yara Rules,Awesome-Yara Detect capacities and universal detection String, Flair FLOSS Detect strings and import (C2, URL) PE-Bear Detect packing CFF Explorer Edit quickly exe"},{"location":"reflex-content/Defend/application/malwares/analysis/#dynamic","title":"Dynamic","text":"Sysinternals <p>Sysinternals suite</p> Tools Usage Procmon Monitor registry, DLL TCP View Monitor   TCP Trafic (Detect C2) Process Hacker Monitor  DLL, open files"},{"location":"reflex-content/Defend/application/malwares/reputation/","title":"Reputation","text":""},{"location":"reflex-content/Defend/application/malwares/reputation/#public-informations","title":"Public informations","text":"<ul> <li>Google search hashs + IOC</li> <li>Fireeye</li> <li>Mandiant</li> </ul> Website Type Description VirusTotal <code>File</code>,<code>Url</code>,<code>Domain</code> Analyse suspicious activity Hybrid-Analysis <code>File</code> Sandbox for windows environnement Any.run <code>File</code> Sandbox for windows environnement ScamDoc <code>Url</code> Assess domain reliability and detect scams"},{"location":"reflex-content/Defend/application/veeam/veeam-linux/","title":"Veeam linux","text":""},{"location":"reflex-content/Defend/application/veeam/veeam-linux/#1-installation-de-veeam-agent-pour-linx","title":"1 \u2013 Installation de Veeam Agent pour Linx","text":"<p>Nous allons nous connecter sur la VM debian en ssh via l\u2019utilitaire putty et lancer les commandes suivantes</p> Text Only<pre><code>apt-get update &amp;&amp; apt-get upgrade\n</code></pre> <p>Ensuite nous allons nous rendre dans le r\u00e9pertoire temporaire de notre VM</p> Text Only<pre><code>cd /tmp\n</code></pre> <p>Nous allons nous connecter sur le site de Veeam https://www.veeam.com/fr/linux-backup-free.html sur notre machine en local pour r\u00e9cup\u00e9rer le lien de t\u00e9l\u00e9chargement de la derni\u00e8re version de Veeam Agent pour Linux. Si vous avez install\u00e9 une interface graphique sur votre Debian, vous pouvez t\u00e9l\u00e9charger directement le package sur la VM</p> <p></p> <p>Cr\u00e9er un compte ou se connecter sur le site de Veeam, choisir la version de votre syst\u00e8me d\u2019op\u00e9ration et l\u2019architecture</p> <p></p> <p>Cliquez sur Download pour r\u00e9cup\u00e9rer le lien de t\u00e9l\u00e9chargement</p> <p></p> <p>Il faut copier le lien de t\u00e9l\u00e9chargement pour r\u00e9cup\u00e9rer le package sur votre machine Debian</p> <p></p> <p>Par la m\u00eame occasion il faut t\u00e9l\u00e9charger l\u2019iso Veeam Linux Recovery Media pour la restauration barre m\u00e9tal que nous verrons apr\u00e8s</p> <p></p> <p>Maintenant sur notre VM Linux, lancer les commandes suivantes</p> Text Only<pre><code># wget https://download2.veeam.com/veeam-release-deb_1.0.7_amd64.deb\n# dpkg -i veeam*.deb\n# apt-get update &amp;&amp; apt-get upgrade\n</code></pre> <p>Installons les packages suivants</p> Text Only<pre><code>apt-get install -y veeam  nfs-common\n</code></pre> <p>D\u00e9marrer Veeam</p> Text Only<pre><code>veeam\n</code></pre> <p>Accepter les conditions et cliquer sur suivant</p> <p></p> <p>Cliquer sur suivant</p> <p></p> <p>Si vous avez une cl\u00e9 de produit il faut la valider sinon cliquez sur Finish</p> <p></p> <p>Appuyez sur la touche de clavier \u00ab\u00a0C\u00a0\u00bb pour configurer votre sauvegarde</p> <p></p> <p>Nommer votre sauvegarde et cliquer sur suivant</p> <p></p> <p>Choisir votre type de sauvegarde</p> <ul> <li>Entire machine : pour sauvegarder toute la machine et avoir la possibilit\u00e9 de faire une sauvegarde barre m\u00e9tal</li> <li>Volume Level vackup : pour sauvegarder une partition pr\u00e9cise de votre machine</li> <li>File level backup : Pour sauvegarder des r\u00e9pertoires pr\u00e9cis de votre serveur</li> </ul> <p>Pour ce tuto nous allons choisir la premi\u00e8re option</p> <p></p> <p>Choisir l\u2019option Veam Backup &amp; Replication Et faire les configurations n\u00e9c\u00e9ssaires.</p> <p></p> <p>Il faut choisir les jours et l\u2019heure de sauvegarde</p> <p></p> <p>Pour finir laisser la case coch\u00e9e pour d\u00e9marrer la sauvegarde imm\u00e9diatement</p> <p></p> <p>Cliquer sur OK</p> <p></p> <p>Patienter jusqu\u2019\u00e0 la fin de la sauvegarde</p> <p> </p> <p>Depuis l'interface de veam vous pouvez constater que votre backup a bien \u00e9t\u00e9 effectu\u00e9e.</p> <p>Source : https://www.networks-it.fr/sauvegarder-une-machine-linux-avec-veeam-agent-sur-un-nas-synology/</p>"},{"location":"reflex-content/Defend/firewall/firewalld/","title":"FirewallD","text":"Check firewall status Bash<pre><code>firewall-cmd --state\n</code></pre> Open ports CustomSSHHTTP/HTTPS Bash<pre><code>firewall-cmd --add-port=&lt;port&gt;/&lt;protocol&gt;  --permanent # (1)\nfirewall-cmd --add-port=&lt;portFrom&gt;-&lt;portTo&gt;/&lt;protocol&gt; --permanent # (2)\nfirewall-cmd --reload # (3)\n</code></pre> <ol> <li>One port</li> <li>Range ports</li> <li>Reload firewalld config</li> </ol> Bash<pre><code>firewall-cmd --zone=public --add-service=ssh --permanent\nfirewall-cmd --reload\n</code></pre> Bash<pre><code>firewall-cmd --zone=public --add-service=http --permanent\nfirewall-cmd --zone=public --add-service=https --permanent\nfirewall-cmd --reload\n</code></pre>"},{"location":"reflex-content/Defend/firewall/firewalld/#sources","title":"Sources","text":"<ul> <li>How To Set Up a Firewall Using FirewallD on CentOS 7</li> </ul>"},{"location":"reflex-content/Defend/firewall/fortigate/","title":"Fortigate","text":"<p>Documentation</p> Installation <ol> <li>Connext with remote console</li> <li>Change the startup password</li> <li><code>execute formatlogdisk</code> format the disk for logs (Init)</li> </ol> Admin port <ol> <li><code>config system interface</code> enter inside configuration menu for interfaces</li> <li><code>edit port6</code> enter in edit menu for admin port</li> <li><code>set ip x.x.x.x mask.mask.mask.mask</code> change ip adress</li> <li><code>set allowaccess ping http https ssh</code> allow network trafic</li> <li><code>end</code> quit menu</li> </ol> Access to outside <ol> <li><code>config system interface</code> enter inside configuration menu for interfaces</li> <li><code>edit port1</code>  enter in edit menu for admin port</li> <li><code>set ip x.x.x.x mask.mask.mask.mask</code> change ip adress</li> <li><code>set allowaccess ping</code> allow network trafic</li> <li><code>end</code> quit menu</li> </ol> Default gateway <ol> <li><code>config router static</code> enter inside configuration menu for gateway</li> <li><code>Edit 1</code> edit entry 1</li> <li><code>Set dst 0.0.0.0 0.0.0.0</code> edit destination adress</li> <li><code>Set device port1</code> edit port</li> <li><code>Set gateway x.x.x.x</code> edit gateway</li> <li><code>End</code> quit menu</li> </ol> DNS server <ol> <li><code>Config system dns</code> enter inside configuration menu for DNS</li> <li><code>Set primary x.x.x.x</code> edit IP adress</li> <li><code>end</code> quit menu</li> </ol> Add licence <ol> <li>Configure administration station to get access to fortigate</li> <li>Use web interface <code>https://$IP</code></li> <li>Follow setup installer</li> </ol> Reverse proxy <p>Reverse Proxy <code>Policy&amp;Objects~&gt;Virtual Server~&gt;Create New</code> * Type : HTTP * Interface : WAN * Virtual server IP : \\ * Virtual server port : \\ * Load Balancing Method : HTTP host * Real Server : dns server dest / port dest / ip dest <p><code>Policy&amp;Objects~&gt;Firewall Policy~&gt;Create New</code> * Inspection mode : Proxy-based * Incoming interface : WAN * Outgoing interface : DMZ-WEB * Source : all * Destination : \\ # NB : doit \u00eatre fait apr\u00e8s avoir configur\u00e9 l'inspection mode et les interfaces * Action : Accept * NAT : enable * Web filter : default * IPS : protect_http_server * SSL Inspection : certificate inspection VPN <p>VPN =&gt; IPsec Wizzard Template type : Custom Network : * IP Address : IP du pare-feu distant * Interface : Interface de sortie (WAN) * NAT Traversal : Disable * Deed Peer Detection : On Idle</p> <p>IKE : Version 2</p> <p>Phase 1 Proposal : (NB : Supprimer les proposisions non conformes) * Encryption : AES256GCM| PRF : PRFSHA256 * Diffie-Hellman Groups : 19 * Key Lifetime : 21600</p> <p>Phase 2 selectors : (NB : Supprimer les proposisions non conformes) New Phase 2 : * Local Address :  * Remote Address :  * Advanced :       * Phase 2 Proposal :         * Encryption : AES256GCM         * Diffie-Hellman Groups : 19         * Key Lifetime : 3600 =&gt; Valider et si n\u00e9cessaire, cliquer sur \"Add\" (dans Phase 2 Selectors), et configurer le prochain r\u00e9seau en suivant la proc\u00e9dure ci-dessus."},{"location":"reflex-content/Defend/firewall/iptables/","title":"Iptables","text":"Rules not persistant <p>By default, rules are note persistant. YOu have ot save and restore at each restart of your os. In debian distribution you can use the package <code>iptables-persistent</code> to automate this task.</p> Error <p>ToDo</p>"},{"location":"reflex-content/Defend/firewall/nftables/","title":"NFTables","text":"Error <p>ToDo</p>"},{"location":"reflex-content/Defend/firewall/step-by-step-configure-fortigate/","title":"Step by step configure fortigate","text":""},{"location":"reflex-content/Defend/firewall/step-by-step-configure-fortigate/#fortigate","title":"Fortigate","text":""},{"location":"reflex-content/Defend/firewall/step-by-step-configure-fortigate/#configuration-de-base","title":"Configuration de base","text":"<ul> <li>[x] Connexion par d\u00e9faut <code>admin</code>:<code></code></li> <li>[x] Changement mdp : <code>admin</code></li> <li>[x] R\u00e9initialiser les logs :<code>execute fomatlogdisk</code> <p>Le reboot qui suivra permettra de prendre en compte les nouvelles interfaces r\u00e9seaux, et dans le bon ordre (1 \u2192 6)</p> </li> <li>[x] Interface ADMIN :  Text Only<pre><code>config system interface\n    edit port6\n    set ip 10.5.5.254 255.255.255.0\n    set allowaccess ping http https ssh\n    end\n</code></pre> <p>port 6 \u00e9tant l'interface de notre LAN ADMIN dans laquelle se trouve notre VM admin</p> </li> <li>[x] Interface WAN :  Text Only<pre><code>config system interface\n    edit port1\n    set ip 192.168.1.105 255.255.255.0\n    set allowaccess ping\n    end\n</code></pre></li> <li>[x] Route par d\u00e9faut :  Text Only<pre><code>config router static\n    edit 1\n    set dst 0.0.0.0 0.0.0.0\n    set device port1\n    set gateway 192.168.1.254\n    end\n</code></pre></li> <li> <p>[x] Serveur DNS :  Text Only<pre><code>config system dns\n    set primary 172.16.1.1\n    end\n</code></pre></p> </li> <li> <p>[x] Test sur FW : Text Only<pre><code>execute ping 192.168.1.254 (connectivit\u00e9 vers INTERCO C4)\nexecute ping www.free.fr (r\u00e9soltution DNS)\n</code></pre></p> </li> </ul>"},{"location":"reflex-content/Defend/firewall/step-by-step-configure-fortigate/#configuration-des-regles-fortinet-depuis-le-poste-admin","title":"Configuration des r\u00e8gles Fortinet depuis le poste ADMIN","text":"<ul> <li> <p>[x] Test sur la machine du VLAN-ADMIN</p> <ol> <li>connecter la machine au LAN</li> <li>d\u00e9activer l'interface r\u00e9seau par d\u00e9faut et n'utiliser que la seconde que l'on vient de cr\u00e9er : <code>ip link set dev ens192 down</code></li> <li>tester la connectivit\u00e9 vers le FW Text Only<pre><code>ping 10.5.5.254\n</code></pre></li> </ol> </li> <li> <p>[x] Transf\u00e9rer le fichier de licence (depuis notre h\u00f4te) sur la machine ADMIN dans <code>/tmp</code> : </p> <ol> <li>right click on Debian ADMIN machine </li> <li>File sharing &gt; Upload file on host</li> <li>Select file : <code>FGVM01TM19003425.lic</code> <p>pr\u00e9sent dans nos ressources Teams</p> </li> <li>Destination folder : <code>/tmp</code></li> </ol> </li> </ul> <p>D\u00e9sormais on utilisera l'interface web : http://10.5.5.254/ - [x] Upload la licence du FW : Fortigate va red\u00e9marrer automatiquement - [x] Se connecter au FW sur https://10.5.5.254/ HOSTNAME : <code>FORTIGATE05</code> Dashboard Setup : Optimal</p> <ul> <li> <p>[x] Changement des interfaces de chaque port dans Network &gt; Interfaces</p> </li> <li> <p>[x] Changement des num\u00e9ros de ports, l'heure et le timeout dans System &gt; settings     &gt; 80:8080 et 443:4343     &gt; GMT +1      &gt; Idle Timeout : 480</p> </li> </ul> <p>Attention le changement de port va modifier notre acc\u00e8s \u00e0 l'interface d'admin web qui sera d\u00e9sormais sur https://10.5.5.254:4343/</p> <ul> <li>[x] Ajout et suppression de features dans System &gt; Feature Visibility</li> </ul> <p></p> <ul> <li>[x] Configuration du firewall en indiquant les port autoris\u00e9s de chaque interface dans Network &gt; Interfaces</li> </ul> <p></p> <ul> <li>[x] Configuration du SMTP avec du NAT (serveur mail) dans Policy &amp; Objects &gt; Virtual IPs</li> </ul> <p>Il faut pour cela cr\u00e9er une Virtual IP, qui relie 192.168.1.105 (interface de sortie) vers 10.5.1.1 (serveur relai en DMZ)</p> <p></p> <ul> <li> <p>[x] Cr\u00e9ation des HOSTS correspondants aux machines en place dans Policy &amp; Objects &gt; Addresses</p> <ul> <li>[x] HOST_ADMIN</li> <li>[x] HOST_SRV-DNS-C4</li> <li>[x] HOST_SPLUNK</li> <li>[x] HOST_DC01</li> <li>[x] HOST_DC02</li> <li>[x] HOST_EXCH</li> <li>[x] HOST_FILER</li> <li>[x] HOST_WEB1</li> <li>[x] HOST_WEB2</li> <li>[x] HOST_WEB3</li> <li>[x] HOST_USR</li> <li>[x] HOST_MTA</li> <li>[x] HOST_RODC</li> <li>[x] HOST_GLPI</li> <li>[x] HOST_ADMINSITE </li> </ul> </li> <li> <p>[x] Cr\u00e9ation de serveur virtuel dans Policy &amp; Objects &gt; Virtual Servers</p> <ul> <li>[x] iis.corp05.com</li> <li>[x] apache.corp05.com</li> <li>[x] shop.corp05.com </li> </ul> </li> </ul> <p></p> <ul> <li>[x] Cr\u00e9ation des politiques firewall dans Policy &amp; Objects &gt; Firewall Policy</li> </ul> Name Description Source Destination Service ADMIN vers WAN autoriser l'h\u00f4te admin \u00e0 naviguer sur le web en http et https HOST_ADMIN all HTTP, HTTPS ADMIN vers DNS autoriser l'hote admin a utilis\u00e9 le DNS quand on sort vers l'ext\u00e9rieur HOST_ADMIN HOST_SERV-DNS-C4 DNS ADMIN vers LOG SPLUNK autoriser l'hote admin \u00e0 ping et joindre le service web de splunk (log supervisor) HOST_ADMIN HOST_SPLUNK HTTP, HTTPS, PING ADMIN vers DMZ WEB autoriser l'admin \u00e0 acc\u00e9der au site WEB (VS) en HTTP et HTTPS HOST_ADMIN HOST_WEB1, HOST_WEB2, HOST_WEB3 HTTP,HTTPS, PING ADMIN vers DMZ RELAY autoriser l'admin uniquement \u00e0 PING le relay MAIL HOST_ADMIN HOST_MTA PING ADMIN vers DC autorier l'admin \u00e0 se connecter au DC et \u00e0 communiquer avec HOST_ADMIN HOST_DC01 PING, RDP, Windows AD (LDAP, Kerberos etc.) ADMIN vers FILER autoriser l'admin \u00e0 utiliser le serveur de fichier HOST_ADMIN HOST_FILER PING, RDP, SMB ADMIN vers EXCH autoris\u00e9 l'admin \u00e0 intervenir sur l'exchange HOST_ADMIN HOST_EXCH RDP, Exchange Server WAN vers DMZ RELAY n'autoriser que le flux SMTP depuis l'ext\u00e9rieur vers notre serveur mail relay en DMZ all VIP_192.168.1.105_SMTP SMTP WAN vers DMZ WEB autoriser les connexions web ext\u00e9rieurs uniquement sur nos VS en DMZ WEB sur le port HTTP all VS_192.168.1.105_HTTP HTTP USER vers Service AD autoriser les utilisateurs \u00e0 communiquer avec les DC avec les services Windows AD (LDAP, Kerberos etc.) HOST_USER HOST_DC01, HOST_DC02 Windows AD, PING USER vers FILER autoriser les utilisateurs \u00e0 joindre le serveur de fichier HOST_USER HOST_FILER SMB, PING ADMIN vers USER autoriser l'admin \u00e0 interagir sur l'hote utilisateur HOST_ADMIN HOST_USER all services <p>Voici les profils de s\u00e9curit\u00e9 que nous ajoutons pour les connexions vers les serveurs WEB en DMZ.</p> <p></p> <p>pensez \u00e0 passez l'inspection mode en Proxy-based</p>"},{"location":"reflex-content/Defend/firewall/step-by-step-configure-vpn-sns-forti/","title":"Step by step configure vpn sns forti","text":""},{"location":"reflex-content/Defend/firewall/step-by-step-configure-vpn-sns-forti/#stormshield","title":"Stormshield","text":"<ul> <li>[x] Effectuer la premi\u00e8re configuration des interfaces en CLI</li> </ul> Text Only<pre><code>VMSNSX01B2085A9&gt;defaultconfig -f -r -p\n\nInterface out (sortie internet) : 192.168.1.205 / 255.255.255.0 / 192.168.1.254\n\nInterface in : 10.101.5.254 / 255.255.255.0\n</code></pre> <ul> <li>[x] Acc\u00e9der \u00e0 la WEB interface depuis un poste admin (http://10.101.5.254) <p>admin:Passw0rd</p> </li> </ul>"},{"location":"reflex-content/Defend/firewall/step-by-step-configure-vpn-sns-forti/#vpn-ipsec-fortinet-stormshield","title":"VPN IPsec Fortinet - Stormshield","text":""},{"location":"reflex-content/Defend/firewall/step-by-step-configure-vpn-sns-forti/#configuration-vpn-fortinet","title":"Configuration VPN Fortinet","text":"<ul> <li> <p>[x] Cr\u00e9ation d'un \"IPsec Tunnels\" dans <code>VPN &gt; IPsec Tunnels &gt; Create New &gt; IPsec Tunnel</code></p> </li> <li> <p>VPN Setup </p> </li> <li>Name : Donner un nom explicite</li> <li>Template type : S\u00e9lectionner \"Site to Site\"</li> <li> <p>Remote device type : S\u00e9lectionner Fortigate</p> </li> <li> <p>Authentication</p> </li> <li>Remote IP address : Adresse IP du pare-feu distant</li> <li>Outgoing interface : WAN</li> <li> <p>Authentication method : Pre-shared Key (puis indiquer la cl\u00e9)</p> </li> <li> <p>Policy &amp; Routing</p> </li> <li>Local interface : interface du (ou des) r\u00e9seau local que l'on veut connecter au VPN</li> <li>Local subnets : normalement autocompl\u00e9t\u00e9</li> <li> <p>Remote subnet : r\u00e9seau local distant \u00e0 joindre/masque</p> </li> <li> <p>Review Settings V\u00e9rifier la configuration et cliquer sur <code>Create</code></p> </li> <li> <p>[x] Passer la configuration VPN en custom</p> </li> <li> <p>S\u00e9lectionner le VPN IPsec pr\u00e9c\u00e9demment cr\u00e9e puis cliquer sur <code>Edit</code></p> </li> <li>Cliquer sur <code>Convert To Custom Tunnel</code></li> </ul> <p></p> <ul> <li>[x] Noter les information de la Phase 1 <p>S\u00e9lectionner qu'un Diffie-Hellman Group</p> </li> </ul> <p></p> <ul> <li>[x] Noter les information de la Phase 2 <p>Ne garder que les 4 premiers algorithmes de chiffrement et authentification S\u00e9lectionner qu'un Diffie-Hellman Group</p> </li> </ul> <p></p> <p>Ajouter chaque r\u00e9seau local dans la phase 2 </p> <p></p> <ul> <li>[x] Finir la configuration en cliquant sur <code>OK</code></li> </ul>"},{"location":"reflex-content/Defend/firewall/step-by-step-configure-vpn-sns-forti/#configuration-vpn-stormshield","title":"Configuration VPN Stormshield","text":"<ul> <li> <p>[x] Cr\u00e9ation d'un \"IPsec Tunnels\" dans <code>VPN &gt; IPsec VPN &gt; Encryption Policy - tunnels &gt; Add &gt; Site-to-Site tunnel</code></p> </li> <li> <p>Local Network</p> </li> <li> <p>S\u00e9lectionner le r\u00e9seau local du FW : Network_in</p> </li> <li> <p>Peer selection</p> </li> <li> <p>Create an IKEv1 peer</p> </li> <li>Remote Gateway : Cr\u00e9er un objet ou S\u00e9lectionner l'objet correspondant \u00e0 l'adresse IP du pare-feu distant</li> <li> <p>Peer creation wizard : S\u00e9lectionner <code>Pre-shared key (PSK)</code> puis \u00e9crire la m\u00eame cl\u00e9 inscrite dans le Fortinet.</p> </li> <li> <p>Remote network</p> </li> <li> <p>Cr\u00e9er un objet ou S\u00e9lectionner l'objet correspondant au r\u00e9seau distant \u00e0 joindre</p> </li> </ul> <p>R\u00e9p\u00e9ter cette \u00e9tape pour chaque LAN distant</p> <p></p> <ul> <li> <p>[x] Modifier les valeurs du chiffrement du VPN site-to-site dans <code>VPN &gt; IPsec VPN &gt; Encryption profiles</code></p> </li> <li> <p>Indiquer les valeurs de la configuration Fortinet pr\u00e9cedente pour l phase 1 et 2</p> </li> </ul> <p></p> <ul> <li> <p>Sauvegarder la configuration</p> </li> <li> <p>[x] Cr\u00e9ation d'une r\u00e8gle statique dans <code>Network &gt; Routing &gt; IPv4 Static routes &gt; Add</code></p> </li> </ul> <p>R\u00e9p\u00e9ter cette \u00e9tape pour chaque LAN distant</p> <p></p> <ul> <li>[x] Cr\u00e9ation d'une r\u00e8gle autorisant le flux entre le LAN Distant et le r\u00e9seau interne</li> </ul> <p>Attention, Stormshield requiert une r\u00e8gle dans les 2 sens pour ICMP par exemple</p> <p></p>"},{"location":"reflex-content/Defend/firewall/stormshield/","title":"Stormshield","text":"<p>Global documentation CLI documentation</p>"},{"location":"reflex-content/Defend/firewall/stormshield/#informations","title":"Informations","text":"<ul> <li>Adress by default</li> </ul> CLI ShellSRPClient Command Explainations <code>defaultconfig -f -r</code> Reset firewall configuration Command Explainations <code>cli</code> Launch SRPClient and start a shell"},{"location":"reflex-content/Defend/firewall/stormshield/#backuprestore","title":"Backup/Restore","text":"CLI BackupUpdateSSH Bash<pre><code>CONFIG BACKUP list=all [password=&lt;password&gt;]&gt; mybackup.na\n# Restaure\nCONFIG RESTORE list=all [password=&lt;password&gt;]&lt; mybackup.na\n</code></pre> Bash<pre><code>SYSTEM UPDATE UPLOAD &lt; file.maj\nSYSTEM UPDATE ACTIVATE\n</code></pre> Bash<pre><code>CONFIG CONSOLE SSH state=1 userpass=1 port=ssh\nCONFIG CONSOLE ACTIVATE\n\nCONFIG CONSOLE SSH state=0\nCONFIG CONSOLE ACTIVATE\n</code></pre>"},{"location":"reflex-content/Defend/firewall/stormshield/#reflex","title":"Reflex","text":""},{"location":"reflex-content/Defend/firewall/stormshield/#install-sns","title":"Install SNS","text":"Setup SNS <ol> <li>Connect to the server with adress</li> <li>Edit interfaces</li> <li>Edit the bridge to allow <code>in</code> and <code>out</code> available (Managing members)</li> <li>Delete the bridge</li> <li>Activate <code>out</code> interface</li> <li>Edit <code>out</code> and change ip range</li> <li>Edit <code>in</code> and change ip route</li> <li>Apply changes</li> <li>Change admin ethernet config</li> <li>Login on https:///admins <li>admin~&gt;Gain write privilege</li> <li>Configuration~&gt;Objects~&gt;Network Object</li> <li>Create gateway object with IP</li> <li>Create dns object with IP</li> <li>In route, edit default gateway</li> <li>Configuration, change DNS to dns object</li> <li>Configuration, change NTP + Timezone</li> <li>Configuration~&gt;Network settings</li> Rules/Objects <ol> <li>Create network object</li> <li>Security policies~&gt;New rules</li> </ol> VPN <p>VPN -&gt; Ipsec VPN -&gt; Encryption Policy -&gt; Site-to-site -&gt; Add -&gt; Site-to-site tunnel (a faire pour chaque r\u00e9seau distant \u00e0 atteindre / r\u00e9seau local \u00e0 partager) * Local network :  * Peer selection =&gt; Create an IKEv2 peer      * Remote gateway :  * Remote network :  <p>VPN -&gt; Ipsec VPN -&gt; Peers * V\u00e9rifier que la version d'IKE est bien en V2 * Si \"IKE profile\" n'est pas en \"StrongEncryption\" (ou configur\u00e9 sur un profil conforme), s\u00e9lectionner \"StrongEncryption\" * Dans 'Advanced properties', mettre le DPD en \"High\" ou en \"Low\"</p> <p>VPN -&gt; Ipsec VPN -&gt; Encryption profiles \u00c0 remplir en suivant recommandation anssi ~&gt; /!\\ IKE et IPSEC (Supprimer tout les profils non conformes, et les proposals non conformes) :</p> <p>IKE | Champ          | Config         | | -------------- | -------------- | | Diffie-Hellman | DH19           | | Lifetime       | 21600          | | Enc_Algo       | AES_gcm_16 256 |</p> <p>IPSEC | Champ          | Config         | | -------------- | -------------- | | Diffie-Hellman | DH19           | | Lifetime       | 3600           | | Enc_Algo       | AES_gcm_16 256 | | Auth_Algo      | hmac_sha384    |</p>"},{"location":"reflex-content/Defend/firewall/ufw/","title":"UFW","text":"<p>Uncomplicated firewall build on the top of <code>iptables</code></p> Status Command Description <code>ufw enable</code> Enable the firewall <code>ufw disable</code> Disable the firewall <code>ufw reload</code> Reload the firewall config after change rules Create rules Command Description <code>ufw allow [port]/[protocol]</code> Allow a port <code>ufw allow from [subnet] to [type] port [port]</code> Allow port from a subnet <code>ufw deny [port]/[protocol]</code> Deny a port <code>ufw deny in on [interface] from [IP]</code> Deny packets from an IP Delete rules Command Description <code>ufw status numbered</code> List rules with id <code>ufw delete [id]</code> Delete rules with id"},{"location":"reflex-content/Defend/siem/linux/","title":"Linux","text":"Timezone <p>Don't forget to synchronize timezone with your hosts.</p> <ul> <li>AuditD</li> <li>SysmonForLinux</li> </ul>"},{"location":"reflex-content/Defend/siem/splunk/","title":"Splunk","text":""},{"location":"reflex-content/Defend/siem/splunk/#server","title":"Server","text":""},{"location":"reflex-content/Defend/siem/splunk/#installation","title":"Installation","text":"<p>Install the debian package, but required curl.</p> <p>Installation folder <code>/opt/splunk</code></p> <p>Launch server, and create the administrator account</p> Bash<pre><code>./splunk start --accept-license --answer-yes\n</code></pre>"},{"location":"reflex-content/Defend/siem/splunk/#forwarders","title":"Forwarders","text":""},{"location":"reflex-content/Defend/siem/splunk/#installation_1","title":"Installation","text":"<p>You can easilly deploy agent with GPO with this tutorial.</p>"},{"location":"reflex-content/Defend/siem/splunk/#fortigate","title":"Fortigate","text":"<p>C\u00f4t\u00e9 SPLUNK R\u00e9cup\u00e9rer l'app et l'add-on pour splunk (sur teams =&gt; en .tgz) et les mettre sur la machine Splunk Sur l'interface web du splunk (127.0.0.1:8000), dans le bandeau du haut (a gauche), cliquer sur <code>Apps -&gt;Manage Apps</code>, puis en haut a droite <code>Install ap from file</code></p> <p>Settings -&gt; Data inputs UDP -&gt; Add new Port 514 =&gt; Next Source type :  Select =&gt; Source type : <code>fgt_log</code> (s'il n'est pas d\u00e9j\u00e0 pr\u00e9sent, faire :  Source type =&gt; New =&gt; Source type : <code>fgt_log</code> | Source Type Category <code>Custom</code>)</p> <p>C\u00f4t\u00e9 Fortigate Log &amp; Report =&gt; Send logs to Syslog : Enable | Ip address/FQDN :  <p>Validation Sur splunk, des logs doivent \u00eatre pr\u00e9sent dans \"Apps\" (sur le menu de gauche) &gt; Fortinet Fortigate App for Splunk</p>"},{"location":"reflex-content/Defend/siem/splunk/#linux","title":"Linux","text":"<p>C\u00f4t\u00e9 client cd /opt tar -zxf splunkforwarder-[...].tgz chown -R root splunkforwarder /opt/splunkforwarder/bin/splunk boot-start /opt/splunkforwarder/bin/splunk start --accept-license</p> <p>C\u00f4t\u00e9 SPLUNK Settings -&gt; Forwarding and receiving Configure receiving -&gt; Add new Sp\u00e9cifier le port \"9997\"</p> <p>C\u00f4t\u00e9 pare-feu Cr\u00e9er un object service pour le port 9997 Ajouter une r\u00e8gle de filtrage passante du client vers splunk pour l'object pr\u00e9cedement cr\u00e9\u00e9. </p> <p>C\u00f4t\u00e9 client /opt/splunkforwarder/bin/splunk add forward-server :9997 V\u00e9rifier que le serveur est bien dans les \"Active forwards\" \u00e0 l'aide de la commade suivante : <code>/opt/splunkforwarder/bin/splunk list forward-server</code> /opt/splunkforwarder/bin/splunk add monitor /var/log/apache2/access.log -index main -sourcetype apache2_access <p>Validation Sur Splunk, aller dans les logs (cliquer sur splunk =&gt; Search &amp; Reporting), chercher <code>*</code>, et dans les events, lister les \"sourcetype\" (volet de gauche) =&gt; v\u00e9rifier que notre source-type y est bien.</p>"},{"location":"reflex-content/Defend/siem/windows/","title":"Windows","text":""},{"location":"reflex-content/Defend/siem/windows/#sysmon","title":"Sysmon","text":"<p>Download Sysmon from Microsoft Website.</p> <p>And now, you can find configurations in the sysmon-modular github repository.</p> <p>Install with config</p> PowerShell<pre><code>.\\Sysmon64.exe -i config.xml\n</code></pre> <p>Update config</p> PowerShell<pre><code>.\\Sysmon64.exe -c config.xml\n</code></pre>"},{"location":"reflex-content/Defend/web/apache/","title":"Apache webserver","text":""},{"location":"reflex-content/Defend/web/apache/#installation-management","title":"Installation &amp; Management","text":"CLI Debian/UbuntuCentOS/RedHat/Rocky/Alma <p>Installation Bash<pre><code>sudo apt install -y apache2\nsudo systemctl enable apache2\nsudo systemctl start apache2\n</code></pre></p> <p>UFW Bash<pre><code>ufw allow http\nufw allow https\nufw enable\n</code></pre></p> <p>Installation Bash<pre><code>sudo dnf install -y httpd\nsudo systemctl enable httpd\nsudo systemctl start httpd\n</code></pre></p> <p>Firewall Bash<pre><code>firewall-cmd --zone=public --add-service=http --permanent\nfirewall-cmd --zone=public --add-service=https --permanent\nfirewall-cmd --reload\n</code></pre></p>"},{"location":"reflex-content/Defend/web/apache/#webserver","title":"Webserver","text":"<p>Configuration folder <code>/etc/apache2</code></p> Files Description <code>/etc/apache2</code> Rename or New <code>/etc/apache2</code> Rename or New <p>Website files path <code>/var/www/html</code></p>"},{"location":"reflex-content/Defend/web/apache/#reverse-proxy","title":"Reverse-proxy","text":"<p>ToDo</p>"},{"location":"reflex-content/Defend/web/apache/#htaccess","title":"Htaccess","text":"<p>ToDo</p>"},{"location":"reflex-content/Defend/web/iis/","title":"IIS","text":"<ul> <li>[x] Installation</li> </ul> <p>IIS est un service Microsoft, nous pouvons donc l'ajouter \u00e0 notre serveur comme n'importe quel autre service.</p> <p>Il suffit donc d'aller dans le menu principal de notre Windows Server 2016, cliquer sur <code>Ajouter des r\u00f4les et fonctionnalit\u00e9s</code>, s\u00e9lectionner son serveur, puis choisir le R\u00f4le <code>Serveur IIS</code>. Ajouter les fonctionalit\u00e9s n\u00e9cessaires au service et finir la configuration. </p> <ul> <li>[x] V\u00e9rification</li> </ul> <p>Pour v\u00e9rifier le fonctionnement du service, il suffit de se rendre sur notre moteur de recherche et taper http://localhost/ </p>"},{"location":"reflex-content/Defend/web/iis/#serveur-de-fichiers","title":"Serveur de fichiers","text":"<ul> <li>[x] Renommer le serveur avec un nom explicite (SRV-FILER)</li> <li>[x] Ajouter le serveur au domaine</li> <li>[x] Ajouter le r\u00f4le \"service de fichier et iSCSI\" et la fonctionnalit\u00e9 \"Support de partage de fichiers SMB\"</li> <li>[x] Dans l'onglet \"service de fichiers et de stockage\", allez dans \"Partages\" &gt; \"Nouveau partage\" et sp\u00e9cifier le dossier \u00e0 partager</li> </ul>"},{"location":"reflex-content/Defend/web/nginx/","title":"Nginx","text":"<p>ToDo</p>"},{"location":"reflex-content/Defend/web/nginx/#reverse-proxy","title":"Reverse-proxy","text":"Text Only<pre><code>server { # simple reverse-proxy\n    listen       80;\n    server_name  domain2.com www.domain2.com;\n    access_log   logs/domain2.access.log  main;\n\n    # serve static files\n    location ~ ^/(images|javascript|js|css|flash|media|static)/  {\n      root    /var/www/virtual/big.server.com/htdocs;\n      expires 30d;\n    }\n\n    # pass requests for dynamic content to rails/turbogears/zope, et al\n    location / {\n      proxy_pass      http://127.0.0.1:8080;\n    }\n  }\n</code></pre>"},{"location":"reflex-content/Defend/web/nginx/#load-balancing","title":"Load balancing","text":"Text Only<pre><code>upstream big_server_com {\n    server 127.0.0.3:8000 weight=5;\n    server 127.0.0.3:8001 weight=5;\n    server 192.168.0.1:8000;\n    server 192.168.0.1:8001;\n  }\n\nserver { # simple load balancing\n    listen          80;\n    server_name     big.server.com;\n    access_log      logs/big.server.access.log main;\n\n    location / {\n      proxy_pass      http://big_server_com;\n    }\n  }\n</code></pre>"},{"location":"reflex-content/Defend/web/nginx/#security-option","title":"Security option","text":"<p>First install nginx plugin to get more option on nginx.</p> <p><code>sudo apt install nginx-extras</code></p> <p>This packet allow you tu use option like more_clear_headers Server</p> YAML<pre><code>  server_tokens off;\nmore_clear_headers Server;\nadd_header X-Content-Type-Options nosniff;\nadd_header X-Frame-Options \"SAMEORIGIN\";\nadd_header X-Robots-Tag none;\nadd_header X-Download-Options noopen;\nadd_header X-Permitted-Cross-Domain-Policies none;\nadd_header X-XSS-Protection \"1; mode=block\";\nadd_header Referrer-Policy \"strict-origin\";\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n</code></pre>"},{"location":"reflex-content/Defend/web/nginx/#documentation","title":"Documentation","text":"<ul> <li>Nginx official documentation</li> </ul>"},{"location":"reflex-content/Defend/web/ssl/","title":"SSL","text":"Website Description SSLlabs Assess SSL security, detect misconfiguration SSL-Config - Mozilla Generate SSL configuration"},{"location":"reflex-content/Defend/web/step-by-step-apache/","title":"Apache","text":"<ul> <li>[x] Installation Pour installer le service Apache sur notre h\u00f4te WEB 1 (sous Debian 10), nous devons installer le paquet apache2. (droit sudo n\u00e9cessaire)</li> </ul> Text Only<pre><code>sudo apt update \nsudo apt install apache2\n</code></pre> <p>Le service tourne par d\u00e9faut sur le port 80.</p> <ul> <li>[x] V\u00e9rification</li> </ul> <p>Nous pouvons lancer cette commande pour v\u00e9rifier si notre service est bien en cours d'ex\u00e9cution</p> Text Only<pre><code>sudo systemctl status apache2\n</code></pre> <p>Nous pouvons d\u00e9sormais nous connecter via notre naviguateur \u00e0 notre \"serveur WEB\" : http://localhost</p> <p></p>"},{"location":"reflex-content/Defend/web/step-by-step-apache/#additionnal-command","title":"Additionnal command","text":"Command Action sudo systemctl stop apache2 Stop sudo systemctl start apache2 Start sudo systemctl restart apache2 Restart sudo systemctl enable apache2 Start automatically on server boot sudo systemctl disable apache2 Deactivate the automatically start"},{"location":"reflex-content/Misc/git/","title":"Git","text":"Setup Command Description <code>git init</code> Initialize a repository <code>git clone [url]</code> Clone a remote repository Stage Command Description <code>git status</code> Show modified files <code>git add [file]</code> Stage file <code>git reset [file]</code> Unstage file <code>git diff</code> Unstaged diff <code>git diff --staged</code> Staged diff Branch Command Description <code>git branch</code> List branch <code>git branch [name]</code> Create new branch <code>git checkout</code> Switch to another branch Synchronisation Command Description <code>git pull</code> Pull from origin <code>git push</code> Push to origin"},{"location":"reflex-content/Misc/git/#sources","title":"Sources","text":"<ul> <li>Git cheatsheat from Github Education</li> </ul>"}]}